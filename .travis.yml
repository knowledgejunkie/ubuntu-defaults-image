sudo: required
language: generic
services:
- docker
jobs:
  include:
  - stage: amd64
    script:
    - docker pull nhsbuntu/ubuntu-defaults-image:latest
    - docker run --env BUILDARCH=amd64 --env BUILDFLAVOUR=gnome --rm -it -v `pwd`:`pwd`
      -w `pwd` --name buildamd64 --privileged nhsbuntu/ubuntu-defaults-image /bin/bash
      -c "./build.sh"
  - stage: i386
    script:
    - docker pull nhsbuntu/ubuntu-defaults-image:latest
    - docker run --env BUILDARCH=i386 --env BUILDFLAVOUR=gnome --rm -it -v `pwd`:`pwd`
      -w `pwd` --name buildi386 --privileged nhsbuntu/ubuntu-defaults-image /bin/bash
      -c "./build.sh"
env:
  global:
  - secure: XRjmzFJObjOEXWj43730QHgBc3UnwR7k6H5dwud0WYFdSY4ai0w63O2wYgkT/gfYGgMuLSzqNIHrI6ugOfhvJxt1PavqSkw/+sAfsRicwOmvPKur2g535onBXkpuflA6kor+tGoEviGAvD+g6a0LM/pT2oHBkJU1s/jTDE6eXvbOF7Cof5VTrYC4Ff8hhSy+ArV0U3gjCPok4/fVtA6fpXdyCaEWvShUEXKZf9xet+xG4+MKBdFivD+95ym3sfY+JElNhFM1mPVgbs0t4xDa72dXyC9+KLc455bhyERfkUrOEpeubI9MHlrgS20yO6FVLCjAGYHd2Nv3MgLnLdPZ1pwLEkefBlgSC0aNdXOAujc+Zd+9MRMLxhTAKczZZXnhqtuSxrSWiVZgc3smKoiDfBwRfylfj4C8ONLXGwkjticWm1porbURGgVDkV85/Ez2malDfiQNiax71lJ9p1YdJj/LKJihYVFgdH/f1JB3qcKE8Xd3g3kfxySszBABoRTcA9p0il8t5q+gLGfrMCau/U942SmrsJ7YLw23Pt2HB8VnCLFaQTuX8pEt34FL+z24L7LXoClQDKFZ5W1blhB2gb9m8bldVGucnJYrzLU4SBKKXr4sZ9UlnGw+KK832gWsYh8qKJajslLIIPFqGW2eKqO8GyrEweBsCzbc7M9FBrI=
  - secure: KJU4rSHDrZpVws0yKHMpeprlJr/DAPJKx9SmGePAjCSeybsmqrBA9BHMGNPn+dGI+DrujcIyOcjUESOUEAeLVo4HvgU2DMVJKRC/bnnai/4ZUsmDOJMTCnjjtuWhqIOO+Wb/Ig5heTXu1uGI8CxZetSD2AtxYvychXTmtSEfsNUIlk7psIo147d/nk4vP4ZuumEZrrXqhGPdsNh8hOApeOZaF6Mxw2qZFG8J1uek9W3H5CYUl+LRcFJoM/fJCGl5h3ACJoUQjlsw/+KyFsxDkF49c5PJjxsl0+dPUpBrBR332Vbrq+jAj3n/p3AA0H0jFqx8fd8CMpyROXh5vL4AMaXwi0yORtHDYARE3kmFPKg6Y1aCYTiKAp/CqzOqu6Q2Z0y/oqq5tOaolsX0YcfTs8JhyEfPyaFo5Q/fpBMEhg44zFU6mAW39S2iopwnuhyuBs8KVJJoHmEWrxpLAe/yy9/wvZkzVwPZ1CkwfOJvEXaA3j0pTiDN7Gvig9XVfN61sGf1RHqpQ5GnQ0Ox6oXAsmI7kZHLgm88EzQmCv72nr4/tNSHAKgAwWF46NZY4qFrI2Iu/P0Jq0jgeYmIRxA953t8g/YZgt+IKu4617aBxSC3MdzipvyA9zRGivXUJ78JelNSm4GNpnR6b9fNtm/J8kf/9qrOXoZ+GRZSsNzudn0=
after_success:
- openssl aes-256-cbc -K $encrypted_11d07880bc5f_key -iv $encrypted_11d07880bc5f_iv
  -in deploy_rsa.enc -out deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 deploy_rsa
- ssh-add deploy_rsa
- scp -o stricthostkeychecking=no NHoS-*-amd64*-binary* $BUILDUSER@$BUILDHOST:/mnt/ISO/amd64
- scp -o stricthostkeychecking=no NHoS-*-i386*-binary* $BUILDUSER@$BUILDHOST:/mnt/ISO/i386
notifications:
  slack:
    secure: r1DhvwOVcxN7JmfBkSF389VhGGUa7UDnG/M+LcxasINe2VV2ymemaxEoVbeDF4unXtwc5xImuYQUxtLs0Q+SmIMAUl0dggv/5quw5gw9hiURdmyC6JPtgDZDPAZ4GUiRFstWhqpRW1n07hHDaSkQOmFJxpTP/mtm80BamXsKYGrW6z/PekcbmDzhfWZk1zAnJTsrNuYFA+Ii9Cv6kUbwEYKlF2axArpcQ7kvOcGY/a6YB36JVxmMmNf6zlTipUka5BUyH5HAUr4eGOwiZ3Flba55/SxDPzFcWO7reLreypjeM471qFpTVOnXmaKH7G3lFunPGu/LIX2hSIUjnrM1E51cNBPeI6cfExoOsH9p0lvDtu191kHnRjWDKyTEJLmmfR5Ibe4UcsYIMxUfE1jNrks1qLxvwKHVBVeFP76RohyzJfg+x/cMQMay76l2TR2+NihaBxoZH+Wjx+2OPvhdVZzyPPWhY/iiSxORlkP7Ad4XMj4FLgbY3fLjvKmaOC+AO8h5i/ZFSoXJ4vCOSFbLFpjAR8dOp8tYAofMDjriT4zXN90Z/+oPRmA8djkEcMXmdMZAHd6hbAd+KK2MwzOHaBAqpmHZKs0gx2tUtJwAc6XKL3RhBq9GIel0IwGnRf4v9xQ3bcMZLUMeAVq/r7f9bQMXyTXI7jVmMLCw5xWEs/g=
